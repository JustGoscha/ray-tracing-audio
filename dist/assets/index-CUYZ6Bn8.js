(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();function ne(e,t){return document.querySelector(e)}function H(){var e=window,t="inner";return"innerWidth"in window||(t="client",e=document.documentElement||document.body),{width:e[t+"Width"],height:e[t+"Height"]}}var h=function(e){var t,n;return e.offsetX!==void 0?(t=e.offsetX,n=e.offsetY):(t=e.layerX-e.currentTarget.offsetLeft,n=e.layerY-e.currentTarget.offsetTop),{x:t,y:n}},re=function(){var e=ne("canvas");ie(e);var t=e.getContext("2d");return[e,t]},ie=function(e){var t=H();e.style.width=`${t.width}px`,e.width=t.width,e.height=t.height-5,e.style.height=`${t.height-5}px`,e.style.top=e.style.bottom=e.style.right=e.style.left=0};function se(){d.width=d.width}var[d,a]=re(),y={line:"#514248",unfinished:"#dbb4ad",ray:"#ebb4a2",red:"#a02e61",lightRed:"hsla(337, 20%, 40%, 0.5)",slight:"#99ad7c",circle:"#53ab6d"};function w(e,t){this.x=e,this.y=t}w.prototype.set=function(e,t){this.x=e,this.y=t};w.prototype.scale=function(e){this.x=this.x*e,this.y=this.y*e};w.prototype.add=function(e){this.x+=e.x,this.y+=e.y};class oe{constructor(t,n){this.position=new w(t,n)}get x(){return this.position.x}get y(){return this.position.y}draw(){a.fillStyle=y.slight,a.fillRect(this.x-5,this.y-5,10,10)}set(t,n){this.position.set(t,n)}}const ae=function(){var{width:e,height:t}=H();return new oe(e/2,t/2)},u=ae();var ce={startTime:0,frameNumber:0,getFPS:function(){this.frameNumber++;var e=performance.now(),t=(e-this.startTime)/1e3,n=Math.floor(this.frameNumber/t);return t>1&&(this.startTime=performance.now(),this.frameNumber=0),n},drawFPS:function(){var e=this.getFPS();a.font="20px sans-serif",a.fillStyle=y.slight,a.fillText(`${e}fps`,5,20)}},s={primaryRays:[],circles:[],finishedLines:[],_distances:[],intersections:[],hiddenIntersections:[],lineBeingDrawn:null,circleBeingDrawn:null,player:u,canvas:d,ctx:a};s.render=function(){fe(),ue(),he(),de(),le(),s.circleBeingDrawn&&s.circleBeingDrawn.draw(this.ctx),this.circles.forEach(e=>e.draw(this.ctx)),this.player.draw()};function le(){s.lineBeingDrawn&&s.lineBeingDrawn.draw(a)}function ue(){for(var e of s.finishedLines)e.draw(a)}function fe(){for(var e of s.primaryRays)e.draw(a)}function de(){a.fillStyle=y.red;for(var e of s.intersections)a.fillRect(e.x-5,e.y-5,10,10)}function he(){a.fillStyle=y.lightRed;for(var e of s.hiddenIntersections)a.fillRect(e.x-5,e.y-5,10,10)}const ye=function(e,t,n){return Math.abs(e.x-t.x)<=n&&Math.abs(e.y-t.y)<=n},m=function(e,t){return e.x*t.x+e.y*t.y},S=Math.PI*2;function X(e){if(e.angle)return e.angle;const t=Math.asin(e.y);return e.x<0?Math.PI-t:t<0?S+t:t}function we(e){const t=Math.sqrt(e.x*e.x+e.y*e.y);return{x:e.x/t,y:e.y/t}}function k(e,t){var n,r,i=0;return n=e.x-t.x,r=e.y-t.y,i=Math.sqrt(n*n+r*r),i}function me(e,t){const n=X(e),r=X(t)%Math.PI,i=(r+(r-n)+S)%S;return{x:Math.cos(i),y:Math.sin(i),angle:i}}function ve(e,t,n){const r={x:n.x-t.center.x,y:n.y-t.center.y},i=Math.sqrt(r.x*r.x+r.y*r.y);r.x/=i,r.y/=i;const o=2*(e.x*r.x+e.y*r.y);return{x:e.x-o*r.x,y:e.y-o*r.y}}const Y=function(e,t){return{x:e.x-t.x,y:e.y-t.y}};function P(e,t,n,r,i="#444"){this.x=e,this.y=t,this.x1=n,this.y1=r,this.vector=new w(n-e,r-t),this.color=i,this.width=2}P.prototype.draw=function(){a.beginPath(),a.moveTo(this.x,this.y),a.lineTo(this.x1,this.y1),a.strokeStyle=this.color,a.lineWidth=this.width,a.stroke(),a.closePath()};P.prototype.setEnd=function(e,t){this.x1=e,this.y1=t,this.vector.set(e-this.x,t-this.y)};P.prototype.setStart=function(e,t){this.x=e,this.y=t,this.vector.set(this.x-x1,this.y-y1)};class q{constructor(t,n){this.center=t,this.radius=n}draw(t,n){t.beginPath();const{x:r,y:i}=this.center;t.lineWidth=2,t.arc(r,i,this.radius,0,2*Math.PI),t.strokeStyle=this.color||y.circle,t.stroke(),t.closePath()}}const E=180,pe=8,xe=2*Math.PI/E;var R=new Array(E);for(var b=0;b<E;b++)R[b]=xe*b,console.log(R[b]);class N{constructor(t,n,r=pe,i){this.maxChildren=r,this.end=new w(n.x,n.y),this.reset(t,n,void 0,i)}get x(){return this.start.x}get y(){return this.start.y}get x1(){return this.end.x}get y1(){return this.end.y}reset(t,n,r=1e4,i){this.start=t,this.end.set(n.x,n.y),this.end.scale(r),this.end.add(t),this.vector=n,this.touchedGeometry=i}reflect(t,n){if(this.maxChildren===0)return;let r=null;if(t instanceof P)r=this.reflectLine(t,n);else if(t instanceof q)r=this.reflectCircle(t,n);else throw new Error("Unknown geometry type");this.maxChildren>0&&(this.child?this.child.reset(n,r,void 0,t):this.child=new N(n,r,this.maxChildren-1,t))}reflectCircle(t,n){const r=ve(this.vector,t,n);return this.reset(this.start,this.vector,n.rayPosition),r}reflectLine(t,n){const r=me(this.vector,we(t.vector));return this.reset(this.start,this.vector,n.rayPosition),r}draw(t,n=y.ray){t.beginPath(),t.moveTo(this.x,this.y),t.lineTo(this.x1,this.y1),t.strokeStyle=`rgba(${200-30*this.maxChildren},20,30,${.15*this.maxChildren})`,t.lineWidth=1,t.stroke(),t.closePath(),this.child&&this.child.draw(t,n)}updatePosition(t){this.reset(t,this.vector)}}var O=0;setInterval(function(){console.log("Intersections checked: "+O)},3e3);function ge(e,t){O++;var n=e.vector,r=t.vector,i={x:-n.y,y:n.x},o={x:-r.y,y:r.x},l=m(Y(e,t),i)/m(r,i),v=m(Y(t,e),o)/m(n,o);return v>0&&l>0&&l<1?{rayPosition:v,x:e.x+v*e.vector.x,y:e.y+v*e.vector.y}:null}function Pe(e,t){const n={x:e.start.x-t.center.x,y:e.start.y-t.center.y},r=m(e.vector,e.vector),i=2*m(e.vector,n),o=m(n,n)-t.radius*t.radius,l=i*i-4*r*o;if(l<0)return null;const v=(-i-Math.sqrt(l))/(2*r),te=(-i+Math.sqrt(l))/(2*r);let p=v;return p<0&&(p=te,p<0)?null:{rayPosition:p,x:e.start.x+p*e.vector.x,y:e.start.y+p*e.vector.y}}function be(e,t){var n,r,i=0;return n=e.x-t.x,r=e.y-t.y,i=n*n+r*r,i}const Me=e=>({shortestDistance:t,nearestIntersect:n,nearestIntersectGeometry:r},i)=>{if(e.touchedGeometry===i)return{shortestDistance:t,nearestIntersect:n,nearestIntersectGeometry:r};let o=null;if(i instanceof q)o=Pe(e,i);else if(i instanceof P)o=ge(e,i);else return console.error("Unknown intersectable type"),{shortestDistance:t,nearestIntersect:n,nearestIntersectGeometry:r};if(o){const l=be(o,e);l<t&&(n=o,r=i,t=l),s.hiddenIntersections.push(o)}return{shortestDistance:t,nearestIntersect:n,nearestIntersectGeometry:r}};function $(e){let t=[...s.finishedLines,...s.circles].reduce(Me(e),{shortestDistance:1/0,nearestIntersect:null,nearestIntersectGeometry:null});return t.nearestIntersect&&(e.reflect(t.nearestIntersectGeometry,t.nearestIntersect),e.child&&e.maxChildren>0&&K($(e.child))),{ray:e,shortestDistance:t.shortestDistance,nearestIntersect:t.nearestIntersect,nearestIntersectLine:t.nearestIntersectLine}}const K=({ray:e,shortestDistance:t,nearestIntersect:n,nearestIntersectLine:r})=>{n?(s.intersections.push(n),s._distances.push(k(n,e))):(s._distances.push(1e4),e.child=void 0)};function Le(){O=0,s.intersections=[],s.hiddenIntersections=[],s._distances=[],s.primaryRays.map($).forEach(K)}var U=window.AudioContext||window.webkitAudioContext||window.MozAudioContext||window.mozAudioContext;U||window.alert("Your browser does not support the WebAudio API or is not compatible with this implementation.");var c=new U,j=c.createDynamicsCompressor(),z=c.createGain();z.connect(j);j.connect(c.destination);function Ce(e){var t=c.createPanner(),n=Math.cos(e),r=-Math.sin(e);return t.panningModel="HRTF",t.distanceModel="linear",t.refDistance=1,t.setPosition(n,0,r),t.connect(z),t}var g=new Array(E);function De(){for(var e=0;e<g.length;e++)g[e]=Ce(R[e])}De();var Be=function(e){var t=c.createBufferSource();return t.buffer=e,t},_=function(e=1,t=8e4){for(var n=c.createBuffer(1,t,c.sampleRate),r=n.getChannelData(0),i=0;i<t;i++)r[i]=Math.random()*e;return n},W=function(e=440,t=1,n=c.sampleRate){for(var r=c.createBuffer(1,n,c.sampleRate),i=r.getChannelData(0),o=0;o<n;o++)i[o]=Math.sin(o*2*Math.PI*(e/c.sampleRate))*t;return r},J=_(.3);W(440,.5);W(560,.4);var F=!1;function Re(){F||(Q(J,0),F=!0)}var L=new Array(g.length);c.sampleRate/60;var J=_(.4);function Ee(){for(var e=0;e<s._distances.length;e++){var t=s._distances[e];t>400?L[e]=_(1e3/(t*t)):L[e]=W(1e4/t,t/300)}for(var e=0;e<L.length;e++)Q(L[e],e)}var B=!1,A={x:0,y:0},M=new Array(g.length),x=new Array(g.length);for(var C=0;C<x.length;C++)x[C]=c.createGain(),x[C].connect(z);function Ae(){if(B=!B,B)for(var e=0;e<x.length;e++)M[e]=c.createOscillator(),M[e].connect(x[e]),M[e].start();else for(var t of M)t.stop()}function Ie(){if(B&&A.x!=u.x&&A.y!=u.y){A={x:u.x,y:u.y};for(var e=0;e<s._distances.length;e++){var t=M[e],n=x[e],r=s._distances[e];r>4e3?(t.frequency.value=0,n.gain.value=0):(t.frequency.value=2e4/r,n.gain.value=r/5e3)}}}function Q(e,t){var n=Be(e);n.connect(g[t]),n.start(),n.onended=function(){F=!1}}function Se(){Le(),se(),s.render(),Ie(),ce.drawFPS()}var{primaryRays:Ve}=s;function ke(){s.primaryRays=R.map(e=>{const t=new w(Math.cos(e),Math.sin(e));return new N(u.position,t)})}function V(){s.primaryRays.forEach(e=>e.updatePosition(u.position))}console.log("shoot-rays.js");ke();const D=2,f={w:!1,a:!1,s:!1,d:!1};function Fe(){let e=0,t=0;f.w&&(t-=D),f.s&&(t+=D),f.a&&(e-=D),f.d&&(e+=D),(e!==0||t!==0)&&(u.set(u.x+e,u.y+t),V())}function Te(){d.addEventListener("mousedown",Ne),Mousetrap.bind(["cmd+z","ctrl+z"],qe),Mousetrap.bind("x",Re),Mousetrap.bind("c",Ee),Mousetrap.bind("v",Ae),document.addEventListener("keydown",e=>{switch(e.key.toLowerCase()){case"w":f.w=!0;break;case"a":f.a=!0;break;case"s":f.s=!0;break;case"d":f.d=!0;break}}),document.addEventListener("keyup",e=>{switch(e.key.toLowerCase()){case"w":f.w=!1;break;case"a":f.a=!1;break;case"s":f.s=!1;break;case"d":f.d=!1;break}})}let T=[];function qe(){const e=T.pop();e&&e()}function Ne(e){var t=h(e);ye(u,t,7)?Oe():e.shiftKey?G(e,"circle"):G(e,"line")}function Oe(e){d.addEventListener("mousemove",Z),d.addEventListener("mouseup",ee)}function Z(e){var{x:t,y:n}=h(e);u.set(t,n),V()}function ee(e){var{x:t,y:n}=h(e);u.set(t,n),d.removeEventListener("mousemove",Z),d.removeEventListener("mouseup",ee),V()}const ze={line:{start:e=>{const{x:t,y:n}=h(e);s.lineBeingDrawn=new P(t,n,t,n,y.unfinished)},update:e=>{if(!s.lineBeingDrawn)return;const{x:t,y:n}=h(e);s.lineBeingDrawn.setEnd(t,n)},finish:e=>{const{x:t,y:n}=h(e);s.lineBeingDrawn.setEnd(t,n),s.lineBeingDrawn.color=y.line,s.lineBeingDrawn.width=4,s.finishedLines.push(s.lineBeingDrawn),s.lineBeingDrawn=null,T.push(()=>s.finishedLines.pop())}},circle:{start:e=>{const{x:t,y:n}=h(e);s.circleBeingDrawn=new q(new w(t,n),0)},update:e=>{const t=h(e),n=k(s.circleBeingDrawn.center,t);s.circleBeingDrawn.radius=n},finish:e=>{const t=h(e),n=k(s.circleBeingDrawn.center,t);s.circleBeingDrawn.radius=n,s.circles.push(s.circleBeingDrawn),s.circleBeingDrawn=null,T.push(()=>s.circles.pop())}}};function G(e,t){const n=ze[t];n.start(e);const r=n.update,i=o=>{n.finish(o),d.removeEventListener("mousemove",r),d.removeEventListener("mouseup",i)};d.addEventListener("mousemove",r),d.addEventListener("mouseup",i)}var I;function _e(){var e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||null;I=function(){Fe(),Se(),e(I)},e(I),console.log("Starting animation.")}function We(){Te(),_e()}We();
//# sourceMappingURL=index-CUYZ6Bn8.js.map
